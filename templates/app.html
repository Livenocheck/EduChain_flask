<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>EduChain Test</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div id="status">Проверка Telegram API...</div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const status = document.getElementById('status');
      
      if (typeof Telegram === 'undefined') {
        status.innerHTML = '❌ Telegram API не загружен';
        return;
      }
      
      if (!Telegram.WebApp) {
        status.innerHTML = '❌ WebApp не инициализирован';
        return;
      }
      
      const initData = Telegram.WebApp.initData;
      if (initData) {
        status.innerHTML = '✅ Успешно! initData получен.<br>' + 
                          '<button onclick="testAuth()">Тест авторизации</button>';
      } else {
        status.innerHTML = '❌ initData пустой';
      }
    });
    
    function testAuth() {
      fetch('./auth', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({initData: Telegram.WebApp.initData})
      })
      .then(r => r.json())
      .then(data => {
        document.getElementById('status').innerHTML += 
          '<br>Ответ сервера: ' + JSON.stringify(data);
      });
    }
  </script>
</body>
</html>