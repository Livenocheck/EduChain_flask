{% extends "base.html" %}

{% block content %}
<style>
  .top-bar {
    background: white;
    padding: 12px 16px;
    margin: -16px -16px 20px -16px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .balance { font-weight: bold; color: var(--success); font-size: 18px; }
  .reward { padding: 16px; border-radius: 16px; background: white; margin: 12px 0; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
  .reward h3 { margin: 0 0 8px 0; }
  .reward p { margin: 4px 0; color: var(--text-light); }
  .out-of-stock { background: #f0f0f0 !important; color: #999 !important; }
</style>

<div class="container">
  <div class="top-bar">
    <div class="balance">ü™ô {{ balance or 0 }} —Ç–æ–∫–µ–Ω–æ–≤</div>
  </div>
  
  <h2 style="margin: 0 0 20px 0;">üõí –ú–∞—Ä–∫–µ—Ç</h2>
  
  {% if rewards %}
    {% for reward in rewards %}
    <div class="reward">
      <h3>{{ reward.name }}</h3>
      <p>{{ reward.description }}</p>
      <p><strong>{{ reward.cost }} ü™ô</strong></p>
      <p>–û—Å—Ç–∞—Ç–æ–∫: 
        {% if reward.quantity is not none %}
          {{ reward.quantity }}
        {% else %}
          ‚àû
        {% endif %}
      </p>
      
      {% if reward.quantity is none or reward.quantity > 0 %}
        <!-- –§–û–†–ú–ê (—Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å) -->
        <form method="POST" action="/marketplace/buy/{{ reward.id }}" style="display: inline; width: 100%;">
          <input type="hidden" name="initData" value="{{ init_data|e }}">
          <button type="submit" class="btn btn-success" style="width: 100%;">–ö—É–ø–∏—Ç—å</button>
        </form>
      {% else %}
        <button class="btn out-of-stock" disabled>–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</button>
      {% endif %}
    </div>
    {% endfor %}
  {% else %}
    <div class="card">
      <p style="text-align: center; color: var(--text-light);">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥</p>
    </div>
  {% endif %}
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  Telegram.WebApp.BackButton.show();
  Telegram.WebApp.BackButton.onClick(function() {
    window.location.href = '/tg_app/?initData=' + encodeURIComponent("{{ init_data|e }}");
  });
</script>
{% endblock %}